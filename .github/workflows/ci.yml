name: Python CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, "3.10", "3.11", "3.12"]

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest

    - name: Install Tesseract for OCR tests
      run: |
        sudo apt-get update
        sudo apt-get install -y tesseract-ocr

    - name: Run basic tests
      run: |
        python tests/test_basic.py

    - name: Run syntax checks on all Python files
      run: |
        python -m py_compile basic_concepts/*.py
        python -m py_compile concurrency/*.py
        python -m py_compile file_operations/*.py
        python -m py_compile ocr_examples/*.py
        python -m py_compile nlp_examples/my_nltk/*.py
        python -m py_compile tensorflow_examples/*.py

    - name: Test key imports
      run: |
        python -c "import basic_concepts.data_structures; print('✓ data_structures import OK')"
        python -c "import basic_concepts.decorators; print('✓ decorators import OK')"
        python -c "import basic_concepts.generators; print('✓ generators import OK')"
        python -c "import concurrency.threading_intro; print('✓ threading import OK')"
        python -c "import file_operations.file_analysis; print('✓ file_analysis import OK')"
        python -c "import tensorflow as tf; print(f'✓ TensorFlow {tf.__version__} import OK')"

    - name: Test NLTK downloads
      run: |
        python -c "import nltk; nltk.download('punkt', quiet=True); print('✓ NLTK punkt downloaded')"
